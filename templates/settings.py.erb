################################################################################
# File managed by Puppet module: <%= scope['module_name'] %>
################################################################################
# Not only will edits be overwritten later, there is also a strong
# possibility of breaking the system if changes are made here without making
# required corresponding changes elsewhere. Refer to the documentation used to
# install Pulpcore to determine the safe and persistent way to modify the
# configuration.
################################################################################

CONTENT_HOST = "<%= scope['pulpcore::servername'] %>"
CONTENT_ORIGIN = "https://<%= scope['pulpcore::servername'] %>"
SECRET_KEY = "<%= scope['pulpcore::django_secret_key'] %>"
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': '<%= scope['pulpcore::postgresql_db_name'] %>',
        'USER': '<%= scope['pulpcore::postgresql_db_user'] %>',
        'PASSWORD': '<%= scope['pulpcore::postgresql_db_password'] %>',
        'HOST': '<%= scope['pulpcore::postgresql_db_host'] %>',
        'PORT': '<%= scope['pulpcore::postgresql_db_port'] %>',
<% if scope['pulpcore::postgresql_db_ssl'] && !scope['pulpcore::postgresql_manage_db'] -%>
        'OPTIONS': {
            'sslmode': '<%= scope['pulpcore::postgresql_db_ssl_require'] ? 'require' : 'disable' %>',
            'sslcert': '<%= scope['pulpcore::postgresql_db_ssl_cert'] %>',
            'sslkey': '<%= scope['pulpcore::postgresql_db_ssl_key'] %>',
            'sslrootcert': '<%= scope['pulpcore::postgresql_db_ssl_root_ca'] %>',
        },
<% end -%>
    },
}
REDIS_URL = "redis://localhost:<%= scope['redis::port'] %>/<%= scope['pulpcore::redis_db'] %>"

<% if scope['pulpcore::worker_ttl'] -%>
WORKER_TTL = <%= scope['pulpcore::worker_ttl'] %>
<% end -%>

MEDIA_ROOT = "<%= scope['pulpcore::media_root'] %>"
STATIC_ROOT = "<%= scope['pulpcore::static_root'] %>"
STATIC_URL = "<%= scope['pulpcore::static_url'] %>"
FILE_UPLOAD_TEMP_DIR = "<%= scope['pulpcore::cache_dir'] %>"
WORKING_DIRECTORY = "<%= scope['pulpcore::cache_dir'] %>"

REMOTE_USER_ENVIRON_NAME = '<%= scope['pulpcore::remote_user_environ_name'] %>'
AUTHENTICATION_BACKENDS = ['pulpcore.app.authentication.PulpNoCreateRemoteUserBackend']

REST_FRAMEWORK__DEFAULT_AUTHENTICATION_CLASSES = (
    'rest_framework.authentication.SessionAuthentication',
    'pulpcore.app.authentication.PulpRemoteUserAuthentication'
)

ALLOWED_IMPORT_PATHS = <%= scope['pulpcore::allowed_import_path'] %>
ALLOWED_EXPORT_PATHS = <%= scope['pulpcore::allowed_export_path'] %>
ALLOWED_CONTENT_CHECKSUMS = <%= scope['pulpcore::allowed_content_checksums'] %>

# Derive HTTP/HTTPS via the X-Forwarded-Proto header set by Apache
SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')

CACHE_ENABLED = <%= scope['pulpcore::cache_enabled'] ? 'True' : 'False' %>
<% if scope['pulpcore::cache_enabled'] && scope['pulpcore::cache_expires_ttl'] -%>
CACHE_SETTINGS = {
    'EXPIRES_TTL': <%= scope['pulpcore::cache_expires_ttl'] %>,
}
<% end -%>

LOGGING = {
    "dynaconf_merge": True,
    "loggers": {
        '': {
            'handlers': ['console'],
            'level': '<%= scope['pulpcore::log_level'] %>',
        },
        "pulpcore.deprecation": {
            "handlers": ["console"],
            "level": "<%= scope['pulpcore::log_level_deprecation'] %>",
            "propagate": False,
        },
        "django_guid": {
            "handlers": ["console"],
            "level": "<%= scope['pulpcore::log_level_correlation_id'] %>",
            "propagate": False,
        },
    }
}
